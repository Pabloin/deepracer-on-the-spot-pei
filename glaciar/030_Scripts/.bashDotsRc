


function prof() {

    source ~/.profile
}

export BASH_DOTS=~/deepracer-on-the-spot-pei/glaciar/030_Scripts
function dots() {
	source  "$BASH_DOTS/.bashDotsRc"
}





function drDown() {

    echo "                                                                 "
    echo "  cd ~/deepracer-on-the-spot-pei/glaciar/012_PEI_Models/T2023-09/LGY_Series/${KEY_MODEL}   "    
    echo "                                                                 "
    echo "  aws s3 sync s3://${S3_BUCKET_SOURCE}/${KEY_MODEL}/ \    "
    echo "                       .logsTmp/${KEY_MODEL}/      "
    echo "                                                                 "
    echo "  cd ~/deepracer-on-the-spot-pei                                 "    
    echo "                                                                 "
    
    
    read -p "Hacemos DOWN? (Y/N): " confirm && [[ $confirm == [yY] || $confirm == [yY][eE][sS] ]] || return 1

    cd ~/deepracer-on-the-spot-pei/glaciar/012_PEI_Models/T2023-09/LGY_Series/${KEY_MODEL}

    aws s3 sync s3://${S3_BUCKET_SOURCE}/${KEY_MODEL}/ \
                         .logsTmp/${KEY_MODEL}/   

    cd ~/deepracer-on-the-spot-pei

}

function drUp() {

    echo "                                                                 "
    echo "  cd ~/deepracer-on-the-spot-pei/glaciar/012_PEI_Models/T2023-09/LGY_Series/${KEY_MODEL}   "    
    echo "                                                                 "
    echo "  aws s3 sync                       .logsTmp/${KEY_MODEL}/  \   "
    echo "          s3://${S3_BUCKET_TARGET}/${KEY_MODEL}/  \   "
    echo "                 --profile voclabs/user2415006=Test_Student      "
    echo "                                                                 "
    echo "  cd ~/deepracer-on-the-spot-pei "    
    echo "                                                                 "
        
    read -p "Hacemos UP? (Y/N): " confirm && [[ $confirm == [yY] || $confirm == [yY][eE][sS] ]] || return 1

    cd ~/deepracer-on-the-spot-pei/glaciar/012_PEI_Models/T2023-09/LGY_Series/${KEY_MODEL}
                                                                
    aws s3 sync                       .logsTmp/${KEY_MODEL}/  \
            s3://${S3_BUCKET_TARGET}/${KEY_MODEL}/  \
                    --profile voclabs/user2415006=Test_Student   

    
    cd ~/deepracer-on-the-spot-pei
    

}


function drSync() {

    echo "hola"
    drDown
    drUp
}


function drImport() {

    aws deepracer list-models --model-type REINFORCEMENT_LEARNING  \
                 --query 'Models[].{ModelArn: ModelArn, ModelName: ModelName} '  \
                 --profile voclabs/user2415006=Test_Student     \
                 --output table


    aws s3 ls s3://${S3_BUCKET_TARGET}/${KEY_MODEL}/  \
                 --profile voclabs/user2415006=Test_Student 

    read -p "Â¿Codigo del Modelo?  (Ejemplo: "lgy-model-NNN" "f01a"? " MODEL_VERSION

    echo "   "
    echo "  aws deepracer import-model \                 "
    echo "      --type REINFORCEMENT_LEARNING \          "
    echo "      --name lgy-model-${MODEL_VERSION}  \                 "
    echo "      --model-artifacts-s3-path s3://${S3_BUCKET_TARGET}/${KEY_MODEL}/lgy-model-${MODEL_VERSION} \ "
    echo "      --role-arn arn:aws:iam::764531084004:role/LabRole \      "
    echo "      --profile voclabs/user2415006=Test_Student               "
    echo "   "

    aws deepracer import-model \
        --type REINFORCEMENT_LEARNING \
        --name lgy-model-${MODEL_VERSION}  \
        --model-artifacts-s3-path s3://${S3_BUCKET_TARGET}/${KEY_MODEL}/lgy-model-${MODEL_VERSION} \
        --role-arn arn:aws:iam::764531084004:role/LabRole \
        --profile voclabs/user2415006=Test_Student               
   
}




##--------------------
function aws.ec2.run() {

    aws ec2 describe-instances --filters Name=instance-state-name,Values=running  \
          --query 'Reservations[].Instances[*].{InstanceType: InstanceType, InstanceId: InstanceId, State: State.Name}'  \
          --output table
}


function aws.ec2.all() {
  REGIONS=`aws ec2 describe-regions --region us-east-1 --output text --query Regions[*].[RegionName]`

  REGIONS_PEI='us-east-1 af-south-1 sa-east-1'
  for REGION in $REGIONS_PEI
  do
    echo -e "\nInstances in '$REGION'..";
    aws ec2 describe-instances --region $REGION | \
      jq '.Reservations[].Instances[] | "EC2: \(.InstanceId): \(.State.Name) \(.InstanceType)  "'
  done
}

##----------------------------
alias F01="cd ~/deepracer-on-the-spot-pei/glaciar/012_PEI_Models/T2023-09/LGY_Series/LGY-Model-f01"
alias F02="cd ~/deepracer-on-the-spot-pei/glaciar/012_PEI_Models/T2023-09/LGY_Series/LGY-Model-F02"
alias F02C="cd ~/deepracer-on-the-spot-pei/glaciar/012_PEI_Models/T2023-09/LGY_Series/LGY-Model-F02/.config_F02Cn"
alias F02D="cd ~/deepracer-on-the-spot-pei/glaciar/012_PEI_Models/T2023-09/LGY_Series/LGY-Model-F02/.config_F02Dn"
alias F02H="cd ~/deepracer-on-the-spot-pei/glaciar/012_PEI_Models/T2023-09/LGY_Series/LGY-Model-F02/.config_F02Hn"
alias F02W="cd ~/deepracer-on-the-spot-pei/glaciar/012_PEI_Models/T2023-09/LGY_Series/LGY-Model-F02/.config_F02Wn"
alias F02T="cd ~/deepracer-on-the-spot-pei/glaciar/012_PEI_Models/T2023-09/LGY_Series/LGY-Model-F02/.config_F02Tn"


alias B01="cd ~/deepracer-on-the-spot-pei/glaciar/012_PEI_Models/T2023-09/AWS_Series/AWS-Beast-B01"

alias   H="cd ~/deepracer-on-the-spot-pei/"

export -f menu
export -f drSync
export -f drDown
export -f drUp


export KEY_MODEL_F01=LGY-Model-F01
export KEY_MODEL_F02=LGY-Model-F02
export KEY_MODEL_AWS=AWS-Beast-B01
export KEY_MODEL=${KEY_MODEL_AWS}


export S3_BUCKET_SOURCE_VIR=base-bucket-1f3pfk38sjoqu
export S3_BUCKET_SOURCE_MIA=base-miami-bucket-1dhaicc3lxjy4
export S3_BUCKET_SOURCE_AFR=base-africa-bucket-eqt69ynz6hf4
export S3_BUCKET_SOURCE_ORE=base-oregon-bucket-178248g6e17yk
export S3_BUCKET_SOURCE=${S3_BUCKET_SOURCE_VIR}

export S3_BUCKET_TARGET_ACADEMY=dr-models-glaciar-dots-std006
export S3_BUCKET_TARGET=${S3_BUCKET_TARGET_ACADEMY}

export REGION_VIR=us-east-1
export REGION_MIA=us-east-1
export REGION_ORE=us-west-1
export REGION_AFR=af-south-1
export REGION=${REGION_VIR}

##----------------------------

function goAfrica() {
    REGION=${REGION_AFR}
    _setRegion
    S3_BUCKET_SOURCE=${S3_BUCKET_SOURCE_AFR}
}

function goVirginia() {
    REGION=${REGION_VIR}
    _setRegion
    S3_BUCKET_SOURCE=${S3_BUCKET_SOURCE_VIR}
}

function goMiami() {
    REGION=${REGION_MIA}
    _setRegion
    S3_BUCKET_SOURCE=${S3_BUCKET_SOURCE_MIA}
}

function goOregon() {
    REGION=${REGION_ORE}
    _setRegion
    S3_BUCKET_SOURCE=${S3_BUCKET_SOURCE_ORE}
}

function _setRegion() {

    echo "Region: ${REGION}"
    
    echo "[default]"           > ~/.aws/config
    echo "region = ${REGION}" >> ~/.aws/config
     cat ~/.aws/config
}

function _getRegion() {
    echo "Region: ${REGION}"
    cat ~/.aws/config
}

##----------------------------

function menu() {
   echo "menu, $1!"
   echo "estoy en  /home/ubuntu/deepracer-on-the-spot-pei/glaciar/030_Scriptsc  "
   echo ""
   
   echo ""
   echo " - prof       |   "
   echo " - drSync     |  drDown     | drUp  "
   echo " - drImport   |   "
   echo " - goVirginia - goMiami     | goAfrica  |  goOregon | _set _getRegion " 
   echo ""
   echo " - aws.ec2.run | aws.ec2.all "
   echo ""
   
   
   echo ""
   echo " alias -  H | B01 | F01 | F02 | F02C,D,H,T,W   "

   echo " MODEL = ${KEY_MODEL}  "
}

menu